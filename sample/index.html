<!doctype html>
<head>
<style>
  body{
    margin:0;
  }

  #image-container{
    line-height:0;
    white-space: nowrap;
    text-align:center;
    margin-top:2em;
  }

  #image-container a{
    display:inline-block;
  }

  img{margin:-1px;border:1px solid white}
  #results{
    font:18px/30px Verdana;
    display:block;
    color:#eee;
    padding:0.75em 1.5em;
    background:#101;
  }

  #results span{
    display:inline-block;
    width:30%
  }
</style>
</head>
<body>
  <div id=results>
    <span id=error-count></span>
    <span id=load-time></span>
  </div>
  <div id=image-container></div>
</body>
<script>
  var
    x = 0,
    y = 0,
    loadTime = [],
    total = 0,
    epoch = new Date(),
    errorCount = 0,
    size = 64,
    cnt = 0;  

  function $(dom) {
    return document.getElementById(dom);
  }
  total = 0;

  function do_status() {

    $("results").innerHTML = "<span>" + [
      "Min: " + loadTime[0],
      "25th perc: " + loadTime[Math.floor(loadTime.length / 4)],
      "Average: " + Math.floor(total / loadTime.length), 
      "75th perc: " + loadTime[3 * Math.floor(loadTime.length / 4)],
      "Max: " + loadTime[loadTime.length - 1],
      "Loaded: " + loadTime.length + " / " + cnt,
      "Errors: " + errorCount
    ].join("</span><span>") + "</span>";
  }

  function generate() {
    var imageContainer = $("image-container");

    for(y = 0; y < 768; y += size) {
      for(x = 0; x < 1024; x += size) {
        var img = document.createElement('img');
        var a = document.createElement("a");

        img.onload = function(){ 
          var delta = (+(new Date()) - epoch); 
          loadTime.push(delta);
          total += delta;
          loadTime = loadTime.sort();
 
          do_status();
        }
        img.onerror = function(){ 
          errorCount++; 
          do_status();
        }
        a.style.width = size + "px";
        a.style.height = size + "px";
        a.appendChild(img);

        // img.src = a.href = "example_o" + size + "x" + size + "p" + y + "p" + x + ".jpg?" + Math.random();
        img.src = a.href = "http://localhost:1210/example_o" + size + "x" + size + "p" + y + "p" + x + ".jpg?" + Math.random();

        imageContainer.appendChild(a);
        cnt++;
      }
      imageContainer.appendChild(document.createElement("br"));
    }
  }
  window.onload = generate;
</script>
